<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.scene.chart.*?>
<?import javafx.scene.control.*?>
<?import javafx.scene.control.cell.PropertyValueFactory?>
<?import javafx.scene.layout.*?>

<?import java.net.URL?>
<?import javafx.collections.FXCollections?>
<?import java.lang.String?>
<StackPane prefHeight="600" prefWidth="800" styleClass="root-style"
           xmlns="http://javafx.com/javafx/17.0.12"
           xmlns:fx="http://javafx.com/fxml/1"
           fx:controller="com.election.controller.AdminController">

    <stylesheets>
        <URL value="@style.css" />
    </stylesheets>

    <TabPane prefHeight="600" prefWidth="800" tabClosingPolicy="UNAVAILABLE">

        <!-- Użytkownicy -->
        <Tab text="Użytkownicy" onSelectionChanged="#handleUserTabSelected">
            <VBox spacing="10" styleClass="vbox-padding">
                <HBox spacing="10" alignment="CENTER_LEFT">
                    <Label styleClass="panel-title" text="Panel administratora" />
                </HBox>
                <HBox spacing="5" alignment="CENTER_LEFT"> <!-- Zmniejszony spacing -->
                    <Label styleClass="form-label" text="Filtry:"/>
                    <TextField fx:id="firstNameFilter" prefWidth="100" promptText="Imię"/>
                    <TextField fx:id="lastNameFilter" prefWidth="100" promptText="Nazwisko"/>
                    <TextField fx:id="peselFilter" prefWidth="120" promptText="PESEL"/>
                    <ComboBox fx:id="roleFilterComboBox" prefWidth="80" promptText="Rola"/>
                    <Button text="Filtruj" prefWidth="80" onAction="#handleFilterUsers"/>
                    <Button text="Wyczyść" prefWidth="80" onAction="#handleClearFilters"/>
                </HBox>
                <TableView fx:id="usersTable">
                    <columns>
                        <TableColumn fx:id="idColumn" prefWidth="50" text="ID" />
                        <TableColumn fx:id="usernameColumn" prefWidth="100" text="Login" />
                        <TableColumn fx:id="roleColumn" prefWidth="100" text="Rola" />
                        <TableColumn fx:id="firstNameColumn" prefWidth="120" text="Imię" />
                        <TableColumn fx:id="lastNameColumn" prefWidth="120" text="Nazwisko" />
                        <TableColumn fx:id="peselColumn" prefWidth="150" text="PESEL" />
                    </columns>
                </TableView>

                <GridPane fx:id="userFormGrid" hgap="10" vgap="10">
                    <Label styleClass="form-label" text="Imię:*" GridPane.columnIndex="0" GridPane.rowIndex="0" />
                    <TextField fx:id="firstNameField" GridPane.columnIndex="1" GridPane.rowIndex="0" />
                    <Label styleClass="form-hint" text="Tylko litery małe (a-z) oraz litery duże (A-Z)" GridPane.columnIndex="2" GridPane.rowIndex="0" />

                    <Label styleClass="form-label" text="Nazwisko:*" GridPane.columnIndex="0" GridPane.rowIndex="1" />
                    <TextField fx:id="lastNameField" GridPane.columnIndex="1" GridPane.rowIndex="1" />
                    <Label styleClass="form-hint" text="Tylko litery małe (a-z) oraz litery duże (A-Z)" GridPane.columnIndex="2" GridPane.rowIndex="1" />

                    <Label styleClass="form-label" text="PESEL:*" GridPane.columnIndex="0" GridPane.rowIndex="2" />
                    <TextField fx:id="peselField" GridPane.columnIndex="1" GridPane.rowIndex="2" />
                    <Label styleClass="form-hint" text="11 cyfr" GridPane.columnIndex="2" GridPane.rowIndex="2" />

                    <Label styleClass="form-label" text="Login:*" GridPane.columnIndex="0" GridPane.rowIndex="3" />
                    <TextField fx:id="usernameField" GridPane.columnIndex="1" GridPane.rowIndex="3" />
                    <Label styleClass="form-hint" text="Tylko litery małe (a-z), litery duże (A-Z), cyfry (0-9) i znak (_)" GridPane.columnIndex="2" GridPane.rowIndex="3" />

                    <Label styleClass="form-label" text="Hasło:*" GridPane.columnIndex="0" GridPane.rowIndex="4" />
                    <HBox GridPane.columnIndex="1" GridPane.rowIndex="4">
                        <PasswordField fx:id="passwordField" HBox.hgrow="ALWAYS" />
                        <TextField fx:id="visiblePasswordField" HBox.hgrow="ALWAYS" visible="false" managed="false" />
                        <Button fx:id="showPasswordButton" styleClass="eye-button" onAction="#togglePasswordVisibility" />
                    </HBox>
<!--                    <Label styleClass="form-hint" text="Nie może być puste" GridPane.columnIndex="2" GridPane.rowIndex="4" />-->

                    <Label styleClass="form-label" text="Rola:*" GridPane.columnIndex="0" GridPane.rowIndex="5" />
                    <ComboBox fx:id="roleComboBox" GridPane.columnIndex="1" GridPane.rowIndex="5" value="USER">
                        <items>
                            <FXCollections fx:factory="observableArrayList">
                                <String fx:value="USER"/>
                                <String fx:value="ADMIN"/>
                            </FXCollections>
                        </items>
                    </ComboBox>
                </GridPane>

                <HBox spacing="10" alignment="CENTER">
                    <Button text="Dodaj nowego" onAction="#handleAddUser" styleClass="button-add" />
                    <Button text="Zapisz zmiany" onAction="#handleUpdateUser" styleClass="button-save" />
                    <Button text="Usuń użytkownika" onAction="#handleDeleteUser" styleClass="button-delete" />
                    <Button text="Wyczyść formularz" onAction="#handleClearUserForm" />
                </HBox>

                <Label fx:id="userManagementStatus" styleClass="status-label" />
            </VBox>
        </Tab>

        <!-- Wyniki wyborów -->
        <Tab text="Wyniki wyborów">
            <VBox spacing="10" styleClass="vbox-padding">
                <Label styleClass="panel-title" text="Aktualne wyniki wyborów" />
                <HBox spacing="20">
                    <TableView fx:id="resultsTable" prefWidth="500">
                        <columns>
                            <TableColumn fx:id="candidateColumn" prefWidth="175" text="Kandydat">
                                <cellValueFactory>
                                    <PropertyValueFactory property="name" />
                                </cellValueFactory>
                            </TableColumn>
                            <TableColumn fx:id="partyColumn" prefWidth="100" text="Partia">
                                <cellValueFactory>
                                    <PropertyValueFactory property="party" />
                                </cellValueFactory>
                            </TableColumn>
                            <TableColumn fx:id="votesColumn" prefWidth="100" text="Liczba głosów">
                                <cellValueFactory>
                                    <PropertyValueFactory property="votes" />
                                </cellValueFactory>
                            </TableColumn>
                        </columns>
                    </TableView>

                    <BarChart fx:id="resultsChart" styleClass="results-chart"
                              legendVisible="false"
                              title="Głosy wg kandydata"
                              minWidth="350"
                              maxWidth="350"
                              minHeight="400"
                              maxHeight="450">
                        <xAxis>
                            <CategoryAxis fx:id="xAxis" label="Kandydat" side="BOTTOM" />
                        </xAxis>
                        <yAxis>
                            <NumberAxis fx:id="yAxis" label="Liczba głosów" />
                        </yAxis>
                    </BarChart>
                </HBox>

                <HBox spacing="10" alignment="CENTER_LEFT">
                    <Button styleClass="button-refresh" onAction="#refreshResults" text="Odśwież wyniki" />
                    <Button styleClass="button-logout" onAction="#handleLogout" text="Wyloguj" />
                    <Label fx:id="statusLabel" styleClass="status-label" />
                </HBox>

                <!-- Przyciski eksportu -->
                <HBox spacing="10" alignment="CENTER_LEFT">
                    <Button styleClass="button-export" onAction="#handleExportToCSV" text="Eksportuj do CSV" />
                    <Button styleClass="button-export" onAction="#handleExportToPDF" text="Eksportuj do PDF" />
                </HBox>
            </VBox>
        </Tab>

        <!-- Narzędzia -->
        <Tab text="Narzędzia">
            <VBox spacing="10" styleClass="vbox-padding">
                <Label styleClass="panel-title" text="Narzędzia administratora" />
                <VBox alignment="CENTER" spacing="15" styleClass="tools-container">
                    <Button styleClass="button-generate" onAction="#handleOpenHashGenerator" text="Otwórz Generator Hashy" />
                    <Button styleClass="button-logout" onAction="#handleLogout" text="Wyloguj" />
                </VBox>
            </VBox>
        </Tab>

<!--        &lt;!&ndash; Zarządzanie użytkownikami &ndash;&gt;-->
<!--        <Tab text="Zarządzaj użytkownikami">-->
<!--            <VBox styleClass="vbox-padding" spacing="10">-->
<!--                <Label styleClass="panel-title" text="Zarządzanie użytkownikami" />-->

<!--                &lt;!&ndash; Wybór akcji &ndash;&gt;-->
<!--                <HBox spacing="10">-->
<!--                    <Label styleClass="form-label" text="Wybierz akcję:" />-->
<!--                    <ComboBox fx:id="actionComboBox" promptText="Wybierz...">-->
<!--                        <items>-->
<!--                            <FXCollections fx:factory="observableArrayList">-->
<!--                                <String fx:value="Dodaj użytkownika"/>-->
<!--                                <String fx:value="Edytuj użytkownika"/>-->
<!--                                <String fx:value="Usuń użytkownika"/>-->
<!--                            </FXCollections>-->
<!--                        </items>-->
<!--                    </ComboBox>-->
<!--                </HBox>-->

<!--                &lt;!&ndash; Pełny formularz danych użytkownika &ndash;&gt;-->
<!--                <GridPane fx:id="userFormGrid" hgap="10" vgap="10" visible="false">-->
<!--                    <Label styleClass="form-label" text="Imię:*" GridPane.columnIndex="0" GridPane.rowIndex="0" />-->
<!--                    <TextField fx:id="firstNameField" GridPane.columnIndex="1" GridPane.rowIndex="0" />-->
<!--                    <Label styleClass="form-hint" text="Tylko litery małe (a-z) oraz litery duże (A-Z)" GridPane.columnIndex="2" GridPane.rowIndex="0" />-->

<!--                    <Label styleClass="form-label" text="Nazwisko:*" GridPane.columnIndex="0" GridPane.rowIndex="1" />-->
<!--                    <TextField fx:id="lastNameField" GridPane.columnIndex="1" GridPane.rowIndex="1" />-->
<!--                    <Label styleClass="form-hint" text="Tylko litery małe (a-z) oraz litery duże (A-Z)" GridPane.columnIndex="2" GridPane.rowIndex="1" />-->

<!--                    <Label styleClass="form-label" text="PESEL:*" GridPane.columnIndex="0" GridPane.rowIndex="2" />-->
<!--                    <TextField fx:id="peselField" GridPane.columnIndex="1" GridPane.rowIndex="2" />-->
<!--                    <Label styleClass="form-hint" text="11 cyfr" GridPane.columnIndex="2" GridPane.rowIndex="2" />-->

<!--                    <Label styleClass="form-label" text="Login:*" GridPane.columnIndex="0" GridPane.rowIndex="3" />-->
<!--                    <TextField fx:id="usernameField" GridPane.columnIndex="1" GridPane.rowIndex="3" />-->
<!--                    <Label styleClass="form-hint" text="Tylko litery małe (a-z), litery duże (A-Z), cyfry (0-9) i znak (_)" GridPane.columnIndex="2" GridPane.rowIndex="3" />-->

<!--                    <Label styleClass="form-label" text="Hasło:*" GridPane.columnIndex="0" GridPane.rowIndex="4" />-->
<!--                    <PasswordField fx:id="passwordField" GridPane.columnIndex="1" GridPane.rowIndex="4" />-->
<!--                    <Label styleClass="form-hint" text="Tylko litery małe (a-z), litery duże (A-Z), cyfry (0-9)" GridPane.columnIndex="2" GridPane.rowIndex="4" />-->

<!--                    <Label styleClass="form-label" text="Rola:*" GridPane.columnIndex="0" GridPane.rowIndex="5" />-->
<!--                    <ComboBox fx:id="roleComboBox" GridPane.columnIndex="1" GridPane.rowIndex="5" value="USER">-->
<!--                        <items>-->
<!--                            <FXCollections fx:factory="observableArrayList">-->
<!--                                <String fx:value="USER"/>-->
<!--                                <String fx:value="ADMIN"/>-->
<!--                            </FXCollections>-->
<!--                        </items>-->
<!--                    </ComboBox>-->
<!--                </GridPane>-->

<!--                &lt;!&ndash; Pole identyfikatora (tylko dla edycji/usuwania) &ndash;&gt;-->
<!--                <GridPane fx:id="identifierGrid" hgap="10" vgap="10" visible="false">-->
<!--                    <Label styleClass="form-label" text="Metoda wyszukiwania:" GridPane.columnIndex="0" GridPane.rowIndex="0" />-->

<!--                    <HBox GridPane.columnIndex="1" GridPane.rowIndex="0" spacing="10">-->
<!--                        <RadioButton fx:id="idRadioButton" text="ID" selected="true" />-->
<!--                        <RadioButton fx:id="peselRadioButton" text="PESEL" />-->
<!--                    </HBox>-->

<!--                    <Label styleClass="form-label" text="ID użytkownika:"-->
<!--                           visible="${idRadioButton.selected}"-->
<!--                           GridPane.columnIndex="0" GridPane.rowIndex="1" />-->
<!--                    <TextField fx:id="idField"-->
<!--                               visible="${idRadioButton.selected}"-->
<!--                               GridPane.columnIndex="1" GridPane.rowIndex="1" />-->

<!--                    <Label styleClass="form-label" text="PESEL użytkownika:"-->
<!--                           visible="${peselRadioButton.selected}"-->
<!--                           GridPane.columnIndex="0" GridPane.rowIndex="2" />-->
<!--                    <TextField fx:id="peselIdentifierField"-->
<!--                               visible="${peselRadioButton.selected}"-->
<!--                               GridPane.columnIndex="1" GridPane.rowIndex="2" />-->
<!--                </GridPane>-->

<!--                <Button fx:id="actionButton" text="Wykonaj" onAction="#handleUserManagement" />-->
<!--                <Button fx:id="refreshButton" text="Wyczyść formularz" onAction="#handleRefreshForm" />-->
<!--                <Label fx:id="userManagementStatus" styleClass="status-label" />-->
<!--            </VBox>-->
<!--        </Tab>-->
        <!-- Zakładka Kandydaci -->
        <Tab text="Kandydaci">
            <VBox styleClass="vbox-padding" spacing="10">
                <Label styleClass="panel-title" text="Zarządzanie kandydatami" />

                <!-- Tabela kandydatów -->
                <TableView fx:id="candidatesTable">
                    <columns>
                        <TableColumn fx:id="candidateIdColumn" prefWidth="50" text="ID" />
                        <TableColumn fx:id="candidateNameColumn" prefWidth="200" text="Imię i nazwisko" />
                        <TableColumn fx:id="candidatePartyColumn" prefWidth="150" text="Partia" />
                        <TableColumn fx:id="candidateVotesColumn" prefWidth="100" text="Głosy" />
                    </columns>
                </TableView>

                <!-- Formularz -->
                <GridPane hgap="10" vgap="10">
                    <Label styleClass="form-label" text="Imię i nazwisko:*" GridPane.columnIndex="0" GridPane.rowIndex="0" />
                    <TextField fx:id="candidateNameField" GridPane.columnIndex="1" GridPane.rowIndex="0" />
                    <Label styleClass="form-hint" text="Wymagane" GridPane.columnIndex="2" GridPane.rowIndex="0" />

                    <Label styleClass="form-label" text="Partia:*" GridPane.columnIndex="0" GridPane.rowIndex="1" />
                    <TextField fx:id="candidatePartyField" GridPane.columnIndex="1" GridPane.rowIndex="1" />
                    <Label styleClass="form-hint" text="Wymagane" GridPane.columnIndex="2" GridPane.rowIndex="1" />
                </GridPane>

                <!-- Przyciski akcji -->
                <HBox spacing="10">
                    <Button text="Dodaj" onAction="#handleAddCandidate" />
                    <Button text="Edytuj" onAction="#handleUpdateCandidate" />
                    <Button text="Usuń" onAction="#handleDeleteCandidate" />
                    <Button text="Odśwież" onAction="#handleRefreshCandidates" />
                    <Button text="Wyczyść formularz" onAction="#handleClearCandidateForm" />
                </HBox>

                <Label fx:id="candidateStatusLabel" styleClass="status-label" />
            </VBox>
        </Tab>
    </TabPane>
</StackPane>